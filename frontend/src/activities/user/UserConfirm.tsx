import styled from '@emotion/styled';
import TextField from '@mui/material/TextField';
import { useActivityParams } from '@stackflow/react';
import { useRef } from 'react';
import { useRecoilValue } from 'recoil';

import { reservation } from '@/api/api';
import { searchState } from '@/atom/atom';
import Layout from '@/components/Layout';
import { useFlow } from '@/useFlow';

const UserConfirm = () => {
  const nicknameRef = useRef<HTMLInputElement>(null);
  const farmerData = useRecoilValue(searchState);
  const { count } = useActivityParams<{
    count: string;
  }>();
  const { push } = useFlow();

  const handleSubmit = () => {
    if (!nicknameRef.current?.value) {
      alert('닉네임을 입력해 주세요');
      return;
    }

    reservation({
      farmId: farmerData.id,
      ggulCount: Number(count),
      nickname: nicknameRef.current.value,
    })
      .then(() => push('AppCompleted', {}))
      .catch(() => alert('이미 신청한 닉네임이에요'));
  };

  return (
    <Layout>
      <Middle>
        <Text>
          반가워요 새로운 귤줍님
          <br />
          신청할 닉네임을 알려주세요
        </Text>
        <svg
          width="239"
          height="190"
          viewBox="0 0 239 190"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <ellipse
            cx="32.3001"
            cy="74.6387"
            rx="17.4468"
            ry="16.1048"
            transform="rotate(-16.4378 32.3001 74.6387)"
            fill="#FFAA01"
          />
          <path
            d="M29.0169 60.7219C29.7184 59.3533 31.5963 59.1598 32.5621 60.3567L32.8593 60.725C33.1257 61.0551 33.5411 61.2281 33.9631 61.1846L35.578 61.0182C36.6551 60.9073 37.0734 62.3793 36.099 62.8513C35.5387 63.1228 35.3769 63.8451 35.7679 64.3296L35.8267 64.4025C36.4547 65.1808 35.7322 66.3109 34.7623 66.0676L31.975 65.3684C31.5188 65.2539 31.0369 65.3036 30.6137 65.5086L28.0275 66.7615C27.1275 67.1975 26.1898 66.2384 26.6459 65.3485L26.6886 65.2651C26.9726 64.711 26.6669 64.0369 26.063 63.8854C25.0128 63.6219 25.1222 62.0955 26.1993 61.9846L27.8142 61.8182C28.2362 61.7747 28.6076 61.5207 28.8011 61.1431L29.0169 60.7219Z"
            fill="#8DC73F"
          />
          <circle
            cx="31.0325"
            cy="61.2552"
            r="1.3425"
            transform="rotate(-45.7906 31.0325 61.2552)"
            fill="#598C45"
          />
          <ellipse
            cx="58.6581"
            cy="59.0884"
            rx="17.4468"
            ry="16.1048"
            transform="rotate(-16.4378 58.6581 59.0884)"
            fill="#FFAA01"
          />
          <path
            d="M55.3748 45.1734C56.0763 43.8047 57.9543 43.6112 58.92 44.8081L59.2172 45.1764C59.4836 45.5066 59.899 45.6796 60.321 45.6361L61.936 45.4697C63.013 45.3587 63.4314 46.8307 62.4569 47.3028C61.8966 47.5742 61.7348 48.2965 62.1258 48.781L62.1847 48.854C62.8126 49.6323 62.0902 50.7623 61.1202 50.519L58.3329 49.8198C57.8767 49.7054 57.3948 49.7551 56.9716 49.9601L54.3854 51.213C53.4854 51.6489 52.5477 50.6899 53.0038 49.8L53.0465 49.7165C53.3305 49.1625 53.0248 48.4883 52.4209 48.3369C51.3707 48.0734 51.4801 46.547 52.5572 46.436L54.1721 46.2696C54.5941 46.2262 54.9655 45.9721 55.159 45.5946L55.3748 45.1734Z"
            fill="#8DC73F"
          />
          <circle
            cx="57.3905"
            cy="45.704"
            r="1.3425"
            transform="rotate(-45.7906 57.3905 45.704)"
            fill="#598C45"
          />
          <ellipse
            cx="77.6652"
            cy="74.9529"
            rx="20.3537"
            ry="18.788"
            transform="rotate(-16.4378 77.6652 74.9529)"
            fill="#FFAA01"
          />
          <path
            d="M73.8351 58.7179C74.6534 57.1212 76.8443 56.8954 77.971 58.2917L78.3177 58.7214C78.6285 59.1066 79.113 59.3084 79.6053 59.2576L81.4894 59.0635C82.7459 58.9341 83.2339 60.6513 82.0971 61.202C81.4435 61.5187 81.2547 62.3613 81.7108 62.9266L81.7795 63.0117C82.5121 63.9196 81.6693 65.238 80.5377 64.9541L77.286 64.1384C76.7538 64.0049 76.1916 64.0629 75.6979 64.3021L72.6808 65.7637C71.6309 66.2723 70.5369 65.1535 71.069 64.1152L71.1189 64.0179C71.4502 63.3715 71.0935 62.5851 70.3891 62.4084C69.1638 62.101 69.2915 60.3203 70.548 60.1909L72.432 59.9967C72.9243 59.946 73.3576 59.6497 73.5833 59.2092L73.8351 58.7179Z"
            fill="#8DC73F"
          />
          <circle
            cx="76.1874"
            cy="59.3393"
            r="1.56617"
            transform="rotate(-45.7906 76.1874 59.3393)"
            fill="#598C45"
          />
          <ellipse
            cx="100.41"
            cy="58.5135"
            rx="17.4468"
            ry="16.1048"
            transform="rotate(-16.4378 100.41 58.5135)"
            fill="#FFAA01"
          />
          <path
            d="M97.1253 44.5985C97.8268 43.2298 99.7047 43.0363 100.671 44.2332L100.968 44.6015C101.234 44.9317 101.649 45.1047 102.071 45.0612L103.686 44.8948C104.764 44.7838 105.182 46.2558 104.207 46.7279C103.647 46.9993 103.485 47.7216 103.876 48.2061L103.935 48.2791C104.563 49.0573 103.841 50.1874 102.871 49.9441L100.083 49.2449C99.6272 49.1305 99.1453 49.1801 98.7221 49.3852L96.1359 50.638C95.2359 51.074 94.2982 50.115 94.7543 49.225L94.797 49.1416C95.081 48.5875 94.7753 47.9134 94.1714 47.7619C93.1212 47.4985 93.2306 45.9721 94.3077 45.8611L95.9226 45.6947C96.3446 45.6512 96.716 45.3972 96.9095 45.0197L97.1253 44.5985Z"
            fill="#8DC73F"
          />
          <circle
            cx="99.1427"
            cy="45.1309"
            r="1.3425"
            transform="rotate(-45.7906 99.1427 45.1309)"
            fill="#598C45"
          />
          <ellipse
            cx="119.651"
            cy="77.228"
            rx="17.4468"
            ry="16.1048"
            transform="rotate(-16.4378 119.651 77.228)"
            fill="#FFAA01"
          />
          <path
            d="M116.368 63.313C117.069 61.9443 118.947 61.7508 119.913 62.9477L120.21 63.316C120.477 63.6462 120.892 63.8191 121.314 63.7757L122.929 63.6093C124.006 63.4983 124.425 64.9703 123.45 65.4423C122.89 65.7138 122.728 66.4361 123.119 66.9206L123.178 66.9936C123.806 67.7718 123.083 68.9019 122.113 68.6586L119.326 67.9594C118.87 67.845 118.388 67.8946 117.965 68.0997L115.379 69.3525C114.479 69.7885 113.541 68.8295 113.997 67.9395L114.04 67.8561C114.324 67.302 114.018 66.6279 113.414 66.4764C112.364 66.213 112.473 64.6866 113.55 64.5756L115.165 64.4092C115.587 64.3657 115.959 64.1117 116.152 63.7341L116.368 63.313Z"
            fill="#8DC73F"
          />
          <circle
            cx="118.384"
            cy="63.8436"
            r="1.3425"
            transform="rotate(-45.7906 118.384 63.8436)"
            fill="#598C45"
          />
          <path
            d="M6.65173 76.0257H148.333C148.333 76.0257 149.977 108.113 140.554 116.919C132.548 124.425 70.9175 131.304 46.6452 134.112C42.1015 134.639 27.3709 133.312 23.6996 130.068C14.4487 121.89 7.72404 105.587 6.65173 76.0257Z"
            fill="#FFAA01"
          />
          <path
            d="M153.403 72.9995H3.87051V78.7428H153.403V72.9995Z"
            fill="#FFAA01"
          />
          <g opacity="0.4">
            <path
              d="M153.403 72.9993H3.87042V78.7425H153.403V72.9993Z"
              fill="#FAFAFA"
            />
          </g>
          <path
            d="M46.3213 186.041C59.4642 183.908 68.3892 171.524 66.2558 158.381C64.1224 145.238 51.7385 136.313 38.5957 138.446C25.4528 140.58 16.5279 152.964 18.6612 166.106C20.7946 179.249 33.1785 188.174 46.3213 186.041Z"
            fill="#2E353A"
          />
          <g opacity="0.35">
            <path
              d="M147.723 95.7726L140.317 106.141C139.027 107.94 138.12 109.984 137.651 112.147C137.182 114.311 137.162 116.547 137.59 118.718C138.66 118.268 139.653 117.654 140.535 116.901C144.824 112.939 146.814 104.169 147.723 95.7726Z"
              fill="black"
            />
          </g>
          <path
            d="M53.7153 162.247C53.7153 160.018 53.0545 157.84 51.8163 155.987C50.5781 154.133 48.8182 152.689 46.7592 151.836C44.7002 150.983 42.4345 150.76 40.2487 151.195C38.0628 151.63 36.055 152.703 34.4791 154.279C32.9032 155.855 31.83 157.863 31.3952 160.049C30.9604 162.234 31.1836 164.5 32.0365 166.559C32.8893 168.618 34.3336 170.378 36.1867 171.616C38.0398 172.854 40.2184 173.515 42.447 173.515C45.4356 173.515 48.3017 172.328 50.4149 170.215C52.5281 168.102 53.7153 165.235 53.7153 162.247Z"
            fill="#F0F0F0"
          />
          <path
            d="M47.5628 162.246C47.5628 161.235 47.2627 160.245 46.7005 159.404C46.1384 158.563 45.3393 157.907 44.4045 157.52C43.4696 157.132 42.4409 157.031 41.4485 157.229C40.456 157.426 39.5444 157.913 38.8289 158.629C38.1134 159.344 37.6261 160.256 37.4287 161.248C37.2313 162.241 37.3326 163.269 37.7199 164.204C38.1071 165.139 38.7628 165.938 39.6042 166.5C40.4455 167.063 41.4347 167.363 42.4466 167.363C43.8035 167.363 45.1048 166.824 46.0643 165.864C47.0237 164.905 47.5628 163.603 47.5628 162.246Z"
            fill="#263238"
          />
          <path
            d="M145.624 182.82C142.623 182.829 139.707 181.819 137.354 179.956C135.002 178.092 133.352 175.484 132.675 172.56L122.506 126.133L61.0755 135.702L45.318 163.873C45.1068 164.25 44.8233 164.582 44.4839 164.849C44.1444 165.117 43.7556 165.315 43.3396 165.432C42.9236 165.549 42.4885 165.584 42.0593 165.533C41.63 165.482 41.215 165.347 40.8379 165.136C40.4608 164.925 40.129 164.641 39.8615 164.302C39.5939 163.962 39.3958 163.574 39.2785 163.158C39.1612 162.741 39.127 162.306 39.1778 161.877C39.2287 161.448 39.3636 161.033 39.5748 160.656L56.1047 131.095C56.3505 130.66 56.6916 130.286 57.1023 130.001C57.513 129.716 57.9828 129.528 58.4765 129.45L124.551 119.154C125.378 119.026 126.222 119.218 126.913 119.69C127.603 120.163 128.088 120.881 128.267 121.698L139.127 171.134C139.338 172.025 139.73 172.863 140.28 173.595C140.83 174.328 141.524 174.939 142.321 175.391C143.117 175.843 143.999 176.126 144.909 176.222C145.82 176.318 146.741 176.226 147.614 175.95C149.206 175.463 150.557 174.396 151.398 172.96C152.24 171.525 152.511 169.825 152.158 168.198L140.79 112.411C140.646 111.712 140.733 110.985 141.035 110.339L155.12 80.6963C155.339 80.236 155.661 79.8325 156.062 79.5172C156.462 79.202 156.93 78.9835 157.429 78.8788L211.471 67.6923C212.307 67.5632 213.16 67.7601 213.855 68.2424C214.55 68.7246 215.033 69.4553 215.205 70.2836C215.376 71.1118 215.223 71.9742 214.777 72.6927C214.331 73.4112 213.625 73.9309 212.807 74.1443L160.364 84.9946L147.46 112.193L158.574 166.853C158.982 168.782 158.955 170.777 158.494 172.694C158.033 174.611 157.15 176.4 155.909 177.932C154.668 179.464 153.101 180.699 151.321 181.548C149.542 182.397 147.596 182.838 145.624 182.838V182.82Z"
            fill="#FFAA01"
          />
          <g opacity="0.7">
            <path
              d="M145.623 182.82C142.622 182.83 139.706 181.82 137.354 179.956C135.001 178.092 133.351 175.485 132.674 172.561L122.505 126.134L61.0747 135.702L45.3172 163.873C45.106 164.25 44.8225 164.582 44.4831 164.85C44.1436 165.117 43.7548 165.315 43.3388 165.433C42.9228 165.55 42.4877 165.584 42.0585 165.533C41.6293 165.483 41.2142 165.348 40.8371 165.136C40.46 164.925 40.1282 164.642 39.8607 164.302C39.5931 163.963 39.395 163.574 39.2777 163.158C39.1604 162.742 39.1262 162.307 39.177 161.878C39.2279 161.448 39.3628 161.033 39.574 160.656L56.1039 131.095C56.3498 130.66 56.6908 130.286 57.1015 130.001C57.5122 129.716 57.982 129.528 58.4757 129.45L124.55 119.154C125.377 119.026 126.221 119.218 126.912 119.691C127.602 120.163 128.087 120.882 128.267 121.699L139.126 171.134C139.337 172.025 139.73 172.863 140.279 173.596C140.829 174.328 141.524 174.94 142.32 175.392C143.117 175.844 143.998 176.127 144.909 176.223C145.819 176.319 146.74 176.226 147.613 175.95C149.205 175.464 150.556 174.397 151.397 172.961C152.239 171.525 152.51 169.825 152.157 168.199L140.789 112.412C140.646 111.713 140.732 110.986 141.034 110.34L155.12 80.6968C155.338 80.2365 155.66 79.833 156.061 79.5177C156.461 79.2025 156.929 78.984 157.428 78.8793L211.47 67.6928C212.306 67.5637 213.16 67.7606 213.855 68.2429C214.549 68.7251 215.032 69.4558 215.204 70.2841C215.375 71.1123 215.222 71.9747 214.776 72.6932C214.33 73.4117 213.625 73.9314 212.806 74.1448L160.363 84.9951L147.459 112.194L158.573 166.854C158.981 168.782 158.954 170.778 158.493 172.695C158.032 174.611 157.149 176.401 155.908 177.933C154.667 179.465 153.1 180.7 151.32 181.549C149.541 182.397 147.595 182.838 145.623 182.839V182.82Z"
              fill="white"
            />
          </g>
          <path
            d="M194.623 68.6468L219.314 63.6215C220.788 63.3728 222.301 63.7069 223.533 64.5533C224.766 65.3996 225.621 66.6918 225.918 68.157C226.216 69.6222 225.932 71.1456 225.127 72.4053C224.321 73.6651 223.058 74.5625 221.604 74.908L196.922 79.9333C196.541 80.006 194.623 68.6468 194.623 68.6468Z"
            fill="#FFAA01"
          />
          <path
            d="M211.517 160.938H238.97L231.001 142.345H203.557L211.517 160.938Z"
            fill="#FFAA01"
          />
          <path
            d="M230.974 142.345H181.33V183.402H230.974V142.345Z"
            fill="#FFAA01"
          />
          <path
            opacity="0.3"
            d="M230.974 142.345H181.33V183.402H230.974V142.345Z"
            fill="#FAFAFA"
          />
          <path
            d="M193.57 142.345H155.094V183.402H193.57V142.345Z"
            fill="#FFAA01"
          />
          <path
            opacity="0.1"
            d="M193.57 142.345H155.094V183.402H193.57V142.345Z"
            fill="#E0E0E0"
          />
          <path
            opacity="0.35"
            d="M155.094 162.874H186.909L193.561 142.345H155.094V162.874Z"
            fill="black"
          />
          <path
            d="M185.6 160.938H147.134L155.094 142.345H193.561L185.6 160.938Z"
            fill="#FFAA01"
          />
        </svg>
        <TextField fullWidth label="닉네임" inputRef={nicknameRef} />
      </Middle>
      <Bottom>
        <NextButton onClick={handleSubmit}>
          <Check />
        </NextButton>
      </Bottom>
    </Layout>
  );
};

export default UserConfirm;

const Middle = styled.div`
  padding: 4rem 2rem 0 2rem;
  display: flex;
  flex-direction: column;
  gap: 2rem;
  align-items: center;
`;

const Text = styled.div`
  width: 100%;
  font-size: 1.4rem;
  font-weight: bold;
  text-align: center;
`;

const NextButton = styled.button`
  float: right;
`;

const Bottom = styled.div`
  width: 92%;
  position: absolute;
  bottom: 40px;
`;

const Check = () => {
  return (
    <svg
      width="56"
      height="56"
      viewBox="0 0 56 56"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <rect width="56" height="56" rx="8" fill="#F57D14" />
      <path
        d="M15 27.4118L24.1765 38L41 18"
        stroke="white"
        strokeWidth="1.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
};
